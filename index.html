<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <title>Cardboard VR - GLTF äº’å‹•</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            position: fixed;
        }

        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 1000;
            max-width: 300px;
        }

        #vr-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            padding: 15px 30px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        #vr-button:hover {
            background: #e64a19;
        }

        #mesh-list {
            position: absolute;
            top: 100px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }

        /* è‡ªè¨‚ Cursor æ¨£å¼ */
        .custom-cursor {
            position: absolute;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="info">
        ğŸ“± ä½¿ç”¨èªªæ˜ï¼š<br>
        1. é»æ“Šä¸‹æ–¹ã€Œé€²å…¥ VRã€æŒ‰éˆ•<br>
        2. å°‡æ‰‹æ©Ÿæ”¾å…¥ Cardboard<br>
        3. è½‰å‹•é ­éƒ¨ç’°é¡§å››å‘¨<br>
        4. å‡è¦–ç‰©é«”èˆ‡å®ƒå€‘äº’å‹•
    </div>

    <div id="mesh-list">
        <strong>GLTF Mesh åˆ—è¡¨ï¼š</strong><br>
        <div id="mesh-names">è¼‰å…¥ä¸­...</div>
    </div>

    <button id="vr-button">ğŸ¥½ é€²å…¥ VR æ¨¡å¼</button>

    <!-- A-Frame è‡ªè¨‚çµ„ä»¶ -->
    <script src="gltf-interactive-component.js"></script>

    <a-scene vr-mode-ui="enabled: true" loading-screen="enabled: false">
        <!-- å¤©ç©ºèƒŒæ™¯ -->
        <a-sky color="#87CEEB"></a-sky>

        <!-- åœ°æ¿ -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" color="#7BC8A4" shadow></a-plane>

        <!-- å…‰æº -->
        <a-light type="ambient" color="#BBB"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.6" position="-1 2 1"></a-light>

        <!-- GLTF æ¨¡å‹ -->
        <a-entity id="my-model" 
            gltf-model="Model\test.glb" 
            position="0 1 -3" 
            scale="0.5 0.5 0.5" 
            gltf-interactive="interactiveMeshes: view_plane">
        </a-entity>

        <!-- æ¸¬è©¦å‹•ç•«çš„ç‰©é«” -->
        <a-box id="test-box" 
            position="2 1.5 -3" 
            color="#FF6B6B"
            click-animation="
                animationType: bounce;
                duration: 500;
            ">
        </a-box>

        <a-sphere id="test-sphere" 
            position="-2 1.5 -3" 
            radius="0.5"
            color="#4ECDC4"
            click-animation="
                animationType: pulse;
                duration: 800;
            ">
        </a-sphere>

        <!-- ç›¸æ©Ÿï¼ˆå« VR æ§åˆ¶ï¼‰ -->
        <a-entity id="camera-rig" camera look-controls wasd-controls position="0 1.6 0">
            <!-- è‡ªè¨‚ Cursor -->
            <a-entity cursor="fuse: true; fuseTimeout: 1500"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                      material="color: #FF6B6B; shader: flat; opacity: 0.8"
                      raycaster="objects: [gltf-interactive], [click-animation]; far: 20"
                      animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                      animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.2 0.2 0.2"
                      animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 300; to: 1 1 1">
                
                <!-- Cursor å…§åœˆé€²åº¦æŒ‡ç¤ºå™¨ -->
                <a-ring position="0 0 0.001"
                        radius-inner="0.008"
                        radius-outer="0.012"
                        material="color: #FFE66D; shader: flat; opacity: 0"
                        animation__fusing="property: material.opacity; startEvents: fusing; dur: 1500; from: 0; to: 1"
                        animation__reset="property: material.opacity; startEvents: mouseleave, click; dur: 100; to: 0">
                </a-ring>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        // é˜²æ­¢ iOS ä¸Šæ–¹å·¥å…·åˆ—
        window.addEventListener('load', () => {
            setTimeout(() => {
                window.scrollTo(0, 1);
            }, 100);
        });

        // ç›£è½æ–¹å‘æ”¹è®Šï¼Œé‡æ–°èª¿æ•´è¦–çª—
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                window.scrollTo(0, 1);
            }, 100);
        });

        // VR æŒ‰éˆ•åŠŸèƒ½
        const vrButton = document.getElementById('vr-button');
        const scene = document.querySelector('a-scene');
        const info = document.getElementById('info');
        const meshList = document.getElementById('mesh-list');

        // å…¨å±€äº‹ä»¶ç›£è½ç¯„ä¾‹
        const entity = document.querySelector('#my-model');
        entity.addEventListener('mesh-clicked', (evt) => {
            console.log('ğŸ“ å…¨å±€äº‹ä»¶ - é»æ“Šäº† Mesh:', evt.detail.name);
            console.log('ğŸ“ é»æ“Šä½ç½®:', evt.detail.point);
            
            // ç™¼é€è‡ªè¨‚å…¨å±€äº‹ä»¶åˆ°å ´æ™¯
            scene.emit('global-mesh-click', {
                meshName: evt.detail.name,
                position: evt.detail.point,
                timestamp: Date.now()
            });
        });

        // ç›£è½å…¨å±€äº‹ä»¶
        scene.addEventListener('global-mesh-click', (evt) => {
            console.log('ğŸŒ å…¨å±€äº‹ä»¶è§¸ç™¼:', evt.detail);
        });

        // æ¸¬è©¦ç‰©é«”çš„é»æ“Šäº‹ä»¶
        document.querySelector('#test-box').addEventListener('object-clicked', (evt) => {
            console.log('ğŸ² æ–¹å¡Šè¢«é»æ“Šäº†ï¼', evt.detail);
        });

        document.querySelector('#test-sphere').addEventListener('object-clicked', (evt) => {
            console.log('âš½ çƒé«”è¢«é»æ“Šäº†ï¼', evt.detail);
        });

        vrButton.addEventListener('click', () => {
            if (scene.hasLoaded) {
                scene.enterVR();
            } else {
                scene.addEventListener('loaded', () => {
                    scene.enterVR();
                });
            }
        });

        scene.addEventListener('enter-vr', () => {
            vrButton.style.display = 'none';
            info.style.display = 'none';
            meshList.style.display = 'none';
        });

        scene.addEventListener('exit-vr', () => {
            vrButton.style.display = 'block';
            info.style.display = 'block';
            meshList.style.display = 'block';
        });
    </script>
</body>

</html>